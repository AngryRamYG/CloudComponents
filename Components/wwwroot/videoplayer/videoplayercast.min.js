var cjs,__awaiter=this&&this.__awaiter||function(n,e,t,o){return new(t||(t=Promise))(function(c,s){function r(n){try{i(o.next(n))}catch(n){s(n)}}function a(n){try{i(o.throw(n))}catch(n){s(n)}}function i(n){var e;n.done?c(n.value):(e=n.value,e instanceof t?e:new t(function(n){n(e)})).then(r,a)}i((o=o.apply(n,e||[])).next())})},__generator=this&&this.__generator||function(n,e){var t,o,c,s,r={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,o&&(c=2&s[0]?o.return:s[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,s[1])).done)return c;switch(o=0,c&&(s=[2&s[0],c.value]),s[0]){case 0:case 1:c=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(c=(c=r.trys).length>0&&c[c.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!c||s[1]>c[0]&&s[1]<c[3])){r.label=s[1];break}if(6===s[0]&&r.label<c[1]){r.label=c[1],c=s;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(s);break}c[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(n,r)}catch(n){s=[6,n],o=0}finally{t=c=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},firstCasting=!0,castPosition=null,castJsUrl="https://cdnjs.cloudflare.com/ajax/libs/castjs/5.2.0/cast.min.js";function loadJs(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){for(var o=document.getElementsByTagName("script"),c=0;c<o.length;c++)if(o[c].src==n)return void e(null);var s=document.createElement("script");s.src=n,s.type="text/javascript",s.onload=function(){e(null)},s.onerror=function(){console.error("Failed to load script: "+n),t("Failed to load script")},document.body.appendChild(s)})]})})}export function createCastJsInstance(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,new window.Castjs]})})}export function init(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){switch(e.label){case 0:return console.log("init: start"),console.log(cjs),[4,loadJs(castJsUrl)];case 1:return e.sent(),console.log("init: js loaded"),cjs||(cjs=new Castjs),[2,new Promise(function(e,t){console.log("init: before event"),cjs.on("event",function(t){return __awaiter(n,void 0,void 0,function(){var n,o;return __generator(this,function(c){switch(c.label){case 0:return n=null,o=!0,"timeupdate"===t&&(n=cjs.time,o=!1),"connect"===t&&(n=cjs.device),o&&(console.log("event: started"),console.log("----------------"),console.log(t),console.log("----------------")),"available"===t?(console.log("event: available"),e(null),[2]):[4,DotNet.invokeMethodAsync("AngryMonkey.Cloud.Components","HandleCastJsEventStatic",t,n)];case 1:return c.sent(),o&&console.log("event: ended"),[2]}})})}),console.log("event: before error"),cjs.on("error",function(n){console.log("error: "+n),t(n)}),cjs.available&&e(null),console.log("init: end")})]}})})}export function startCasting(n,e,t){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(c){return console.log("casting: started"),console.log(cjs),o=cjs.connected&&cjs.src===n,console.log("casting: already casting = "+o),o||(firstCasting=!0,console.log("casting: cast url"),cjs.cast(n,{title:e}),console.log("casting: cast url end")),void 0!==t&&(firstCasting?castPosition=t:cjs.seek(t)),console.log("casting: before play"),console.log("casting: Available = "+cjs.available),console.log("casting: Connected = "+cjs.connected),console.log(cjs),console.log("_____________________________________"),cjs.play(),console.log("casting: after play"),console.log("casting: Available = "+cjs.available),console.log("casting: Connected = "+cjs.connected),console.log(cjs),console.log("_____________________________________"),console.log("casting: end"),[2]})})}export function stopCasting(){cjs.available&&cjs.disconnect()}export function pauseCasting(){cjs.available&&cjs.pause()}export function playCasting(){cjs.available&&cjs.play()}